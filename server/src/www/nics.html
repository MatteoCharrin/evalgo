<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Interfaces réseau — multi-agents</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { color-scheme: light dark; }
    body { margin:0; padding:24px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:canvas; color:canvastext; }
    .wrap { max-width:980px; margin:0 auto; display:grid; gap:16px; }
    .card { padding:16px 20px; border:1px solid color-mix(in oklab, canvastext 15%, transparent); border-radius:16px; background:color-mix(in oklab, canvas 92%, canvastext 0%); box-shadow:0 1px 8px color-mix(in oklab, canvastext 10%, transparent); }
    h1 { margin:0 0 8px; font-size:1.25rem; }
    h2 { margin:0 0 10px; font-size:1.05rem; }
    .muted { opacity:.75; font-size:.9rem; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px 10px; border-bottom:1px solid color-mix(in oklab, canvastext 12%, transparent); text-align:left; }
    th { font-weight:600; }
    .addr { font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:.9rem; }
    .right { text-align:right; }
    .small { font-size:.9rem; }
    .badge { display:inline-block; padding:.15rem .45rem; border-radius:.5rem; border:1px solid color-mix(in oklab, canvastext 25%, transparent); }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>Interfaces réseau actives — multi-agents</h1>
      <div class="muted">Source : <code>/api/nics</code></div>
    </section>

    <div id="root" class="wrap"></div>
  </div>

  <script>
    function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}
    function rows(data){
      if(!Array.isArray(data)||!data.length) return '<tr><td colspan="5" class="muted">Aucune interface</td></tr>';
      return data.map(n=>{
        const addrs = Array.isArray(n.addr)? n.addr.map(a=>'<span class="addr">'+esc(a)+'</span>').join('<br>') : '';
        return '<tr>'
          + '<td><span class="badge">'+esc(n.name||'')+'</span></td>'
          + '<td>'+addrs+'</td>'
          + '<td class="right">'+((Number(n.rx_mbps)||0).toFixed(3))+'</td>'
          + '<td class="right">'+((Number(n.tx_mbps)||0).toFixed(3))+'</td>'
          + '<td class="right small">'+esc(n.mtu||'')+'</td>'
          + '</tr>';
      }).join('');
    }
    function card(it){
      if(it.err) return '<section class="card"><h2>'+esc(it.host)+' ('+esc(it.id)+')</h2><div class="muted">Erreur: '+esc(it.err)+'</div></section>';
      return '<section class="card"><h2>'+esc(it.host)+' ('+esc(it.id)+')</h2>'
        + '<table><thead><tr><th>Interface</th><th>Adresses</th><th class="right">Rx (Mb/s)</th><th class="right">Tx (Mb/s)</th><th class="right small">MTU</th></tr></thead>'
        + '<tbody>'+rows(it.data||[])+'</tbody></table></section>';
    }
    async function load(){
      const root=document.getElementById('root');
      try{
        const res=await fetch('/api/nics');
        if(!res.ok) throw new Error('HTTP '+res.status);
        const all=await res.json();
        if(!Array.isArray(all)||!all.length){ root.innerHTML='<section class="card muted">Aucun agent</section>'; return; }
        root.innerHTML = all.map(card).join('');
      }catch(e){
        root.innerHTML = '<section class="card"><div class="muted">Erreur: '+esc(e.message)+'</div></section>';
      }
    }
    load(); setInterval(load, 2000);
  </script>
</body>
</html>
