<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>CPU — multi-agents</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { color-scheme: light dark; }
    body { margin:0; padding:24px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:canvas; color:canvastext; }
    .wrap { max-width:1200px; margin:0 auto; display:grid; gap:16px; }
    .card { padding:16px 20px; border:1px solid color-mix(in oklab, canvastext 15%, transparent); border-radius:16px; background:color-mix(in oklab, canvas 92%, canvastext 0%); box-shadow:0 1px 8px color-mix(in oklab, canvastext 10%, transparent); }
    h1 { margin:0 0 8px; font-size:1.25rem; }
    h2 { margin:0 0 12px; font-size:1.1rem; }
    .muted { opacity:.75; font-size:.9rem; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px 10px; border-bottom:1px solid color-mix(in oklab, canvastext 12%, transparent); text-align:left; vertical-align:top; }
    th { font-weight:600; }
    .right { text-align:right; }
    .mono { font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:.9rem; }
    .pill { display:inline-block; padding:.12rem .45rem; border-radius:.75rem; border:1px solid color-mix(in oklab, canvastext 25%, transparent); font-size:.8rem; margin:2px; }
    .badges { display:flex; flex-wrap:wrap; gap:4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>Informations CPU — multi-agents</h1>
      <div class="muted">Source : <code>/api/cpus</code></div>
    </section>

    <div id="root" class="wrap"></div>
  </div>

  <script>
    function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}
    function flags(arr){ if(!Array.isArray(arr)||!arr.length) return '';
      return '<div class="badges">'+arr.map(f=>'<span class="pill">'+esc(f)+'</span>').join('')+'</div>'; }
    function table(rows){
      if(!rows.length) return '<div class="muted">Aucune donnée</div>';
      return '<table><thead><tr>'
        +'<th class="right">CPU</th><th>Vendor</th><th>CoreID</th><th class="right">Cores</th>'
        +'<th>Model</th><th class="right">MHz</th><th class="right">Cache</th><th>Flags</th>'
        +'</tr></thead><tbody>'+rows.map(x=>(
          '<tr>'
          +'<td class="right mono">'+esc(x.cpu)+'</td>'
          +'<td>'+esc(x.vendorId||'')+'</td>'
          +'<td class="mono">'+esc(x.coreId||'')+'</td>'
          +'<td class="right mono">'+esc(x.cores||0)+'</td>'
          +'<td class="mono">'+esc(x.model||x.modelName||'')+'</td>'
          +'<td class="right mono">'+esc(x.mhz||0)+'</td>'
          +'<td class="right mono">'+esc(x.cacheSize||0)+'</td>'
          +'<td>'+flags(x.flags)+'</td>'
          +'</tr>'
        )).join('')+'</tbody></table>';
    }
    function card(it){
      if(it.err) {
        return '<section class="card"><h2>'+esc(it.host)+' ('+esc(it.id)+')</h2>'
             + '<div class="muted">Erreur: '+esc(it.err)+'</div></section>';
      }
      var data = Array.isArray(it.data)? it.data : [];
      return '<section class="card"><h2>'+esc(it.host)+' ('+esc(it.id)+')</h2>'+table(data)+'</section>';
    }
    async function load(){
      const root = document.getElementById('root');
      try{
        const res = await fetch('/api/cpus');
        if(!res.ok) throw new Error('HTTP '+res.status);
        const all = await res.json(); // [{id,host,url,data,err}]
        if(!Array.isArray(all) || !all.length){ root.innerHTML='<section class="card muted">Aucun agent</section>'; return; }
        root.innerHTML = all.map(card).join('');
      }catch(e){
        root.innerHTML = '<section class="card"><div class="muted">Erreur: '+esc(e.message)+'</div></section>';
      }
    }
    load();
  </script>
</body>
</html>
