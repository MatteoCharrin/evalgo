<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Volumes & montages — multi-agents</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { color-scheme: light dark; }
    body { margin:0; padding:24px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:canvas; color:canvastext; }
    .wrap { max-width:980px; margin:0 auto; display:grid; gap:16px; }
    .card { padding:16px 20px; border:1px solid color-mix(in oklab, canvastext 15%, transparent); border-radius:16px; background:color-mix(in oklab, canvas 92%, canvastext 0%); box-shadow:0 1px 8px color-mix(in oklab, canvastext 10%, transparent); }
    h1 { margin:0 0 8px; font-size:1.25rem; }
    h2 { margin:0 0 10px; font-size:1.05rem; }
    .muted { opacity:.75; font-size:.9rem; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px 10px; border-bottom:1px solid color-mix(in oklab, canvastext 12%, transparent); text-align:left; vertical-align:top; }
    th { font-weight:600; }
    .mono { font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:.9rem; }
    .badges { display:flex; gap:6px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:.12rem .45rem; border-radius:.5rem; border:1px solid color-mix(in oklab, canvastext 25%, transparent); font-size:.85rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>Volumes et points de montage — multi-agents</h1>
      <div class="muted">Source : <code>/api/disks</code></div>
    </section>

    <div id="root" class="wrap"></div>
  </div>

  <script>
    function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}
    function rows(items){
      if(!Array.isArray(items)||!items.length) return '<tr><td colspan="4" class="muted">Aucune donnée</td></tr>';
      return items.map(x=>{
        const opts = Array.isArray(x.opts)? x.opts: [];
        const optsHtml = '<div class="badges">'+opts.map(o=>'<span class="badge">'+esc(o)+'</span>').join('')+'</div>';
        return '<tr>'
          + '<td class="mono">'+esc(x.device||'')+'</td>'
          + '<td class="mono">'+esc(x.mountpoint||'')+'</td>'
          + '<td>'+esc(x.fstype||'')+'</td>'
          + '<td>'+optsHtml+'</td>'
          + '</tr>';
      }).join('');
    }
    function card(it){
      if(it.err) return '<section class="card"><h2>'+esc(it.host)+' ('+esc(it.id)+')</h2><div class="muted">Erreur: '+esc(it.err)+'</div></section>';
      const data = Array.isArray(it.data)? it.data : [];
      return '<section class="card"><h2>'+esc(it.host)+' ('+esc(it.id)+')</h2>'
        + '<table><thead><tr><th>Device</th><th>Mountpoint</th><th>Type</th><th>Options</th></tr></thead>'
        + '<tbody>'+rows(data)+'</tbody></table></section>';
    }
    async function load(){
      const root=document.getElementById('root');
      try{
        const res=await fetch('/api/disks');
        if(!res.ok) throw new Error('HTTP '+res.status);
        const all=await res.json();
        if(!Array.isArray(all)||!all.length){ root.innerHTML='<section class="card muted">Aucun agent</section>'; return; }
        root.innerHTML = all.map(card).join('');
      }catch(e){
        root.innerHTML = '<section class="card"><div class="muted">Erreur: '+esc(e.message)+'</div></section>';
      }
    }
    load();
  </script>
</body>
</html>
